<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Welcome to the Interactive Adventure Room!</title>
</head>

<style>
    body {
        min-width: 800px;
        background-color: #FFFFFF;
        color: black;
    }

    .message {
        padding-top: 20px 0;
        font-family: "Times New Roman";
        font-size: 16px;
    }

    .submitForm {
        padding-bottom: 20px;
        max-width: 800px;
    }

    .inputForm {
        border: 0;
        outline: none;
        font-family: "Times New Roman";
        font-size: 16px;
        background: transparent;
        color: black;
    }
</style>
<div id="messageBox">
    <div class="message">
        <p><b>Welcome to the Alex's Studio Apartment!</b><br>Enter a command or type "help" for a list of commands.<br>
            <hr>
        </p>
    </div>
</div>

<form class="submitForm" id="command" action="" autocomplete="off">
    <b>>> </b>
    <input size=64 class="inputForm" type="text" id="userCom" autofocus placeholder="Enter a command or type 'help'"
        onfocus="this.placeholder =''" onblur="this.placeholder='Enter a command or type &quot;help&quot;'">
</form>

</body>
<script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
    crossorigin="anonymous"></script>
<script>
    $(function () {

        function newMessage(msg) {
            if (suppressMessages != true) {
                //Adds new div to HTML body to display messages
                let messages = document.getElementById("messageBox");
                let newDiv = document.createElement('div');

                //Create new div to append to MESSAGEBOX
                newDiv.className = "message";
                messages.appendChild(newDiv);

                //Create new p to insert into MESSAGE
                messageText = document.createElement('p');
                messageText.innerHTML = msg;
                newDiv.appendChild(messageText);
            };

            var socket = io();
            const userId = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);

            socket.on('connect', () => {
                socket.emit('userId', userId)
            })

            $('form').submit(function (e) {

                
                e.preventDefault(); // prevents page reloading

                // sends an array of [user command string, userId]
                socket.emit('chat message', [$('inputForm').val(), userId]);
                $('inputForm').val('');
                return false;
            });

            $(document).ready(function () {
                $('#command').submit(function (e) {
                    e.preventDefault();
                    if ($("#userCom").val() == "") {
                        e.preventDefault();
                    }
                    else {
                        e.preventDefault();
                        socket.emit('chat message', [$('inputForm').val(), userId]);
                    };
                    $(document).scrollTop($(document).height()); //scroll to bottom
                    $('#command').trigger("reset"); //Resets the text box
                });
            });

            socket.on('chat message', function (msg) {
                newMessage(msg)
            });

            socket.on("disconnectEvent", () => {
                socket.disconnect("HEY HEY HEY")
            })
        }
    });
</script>
<script></script>

</html>